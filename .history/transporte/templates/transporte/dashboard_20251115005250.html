{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Log√≠stica Global{% endblock %}

{% block content %}
<div class="page-title">
    <span>üìä</span>
    <span>Dashboard Principal</span>
</div>

<!-- Estad√≠sticas Principales -->
<div class="stats-grid">
    <div class="stat-card" onclick="window.location.href='{% url 'despachos' %}'">
        <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary), var(--secondary));">üì¶</div>
        <div>
            <div class="stat-value">{{ total_despachos }}</div>
            <div class="stat-label">Total Despachos</div>
        </div>
    </div>
    
    <div class="stat-card" onclick="window.location.href='{% url 'vehiculos' %}'">
        <div class="stat-icon" style="background: linear-gradient(135deg, var(--success), #059669);">üöõ</div>
        <div>
            <div class="stat-value">{{ total_vehiculos }}</div>
            <div class="stat-label">Veh√≠culos Activos</div>
        </div>
    </div>
    
    <div class="stat-card" onclick="window.location.href='{% url 'aeronaves' %}'">
        <div class="stat-icon" style="background: linear-gradient(135deg, var(--info), #1d4ed8);">‚úàÔ∏è</div>
        <div>
            <div class="stat-value">{{ total_aeronaves }}</div>
            <div class="stat-label">Aeronaves Activas</div>
        </div>
    </div>
    
    <div class="stat-card" onclick="window.location.href='{% url 'clientes' %}'">
        <div class="stat-icon" style="background: linear-gradient(135deg, var(--accent), #d97706);">üë•</div>
        <div>
            <div class="stat-value">{{ total_clientes }}</div>
            <div class="stat-label">Clientes Activos</div>
        </div>
    </div>
</div>

<div class="dashboard-grid">
    <!-- √öltimos Despachos -->
    <div class="content-card">
        <div class="card-header">
            <h3>üì¶ √öltimos Despachos</h3>
            <a href="{% url 'despachos' %}" class="btn">Ver Todos</a>
        </div>
        
        {% if ultimos_despachos %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--border);">
                            <th style="padding: 1rem; text-align: left;">ID</th>
                            <th style="padding: 1rem; text-align: left;">Cliente</th>
                            <th style="padding: 1rem; text-align: left;">Ruta</th>
                            <th style="padding: 1rem; text-align: left;">Estado</th>
                            <th style="padding: 1rem; text-align: left;">Fecha</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for despacho in ultimos_despachos %}
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 1rem;">DESP-{{ despacho.id }}</td>
                            <td style="padding: 1rem;">{{ despacho.cliente.razon_social|default:despacho.cliente.nombre }}</td>
                            <td style="padding: 1rem;">{{ despacho.ruta.origen }} - {{ despacho.ruta.destino }}</td>
                            <td style="padding: 1rem;">
                                <span class="badge 
                                    {% if despacho.estado == 'ENTREGADO' %}active
                                    {% elif despacho.estado == 'EN_RUTA' %}info
                                    {% elif despacho.estado == 'PENDIENTE' %}pending
                                    {% else %}alert{% endif %}">
                                    {{ despacho.estado }}
                                </span>
                            </td>
                            <td style="padding: 1rem;">{{ despacho.fecha_despacho|date:"d/m/Y" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                No hay despachos registrados
            </div>
        {% endif %}
    </div>

    <!-- Informaci√≥n del Sistema -->
    <div class="content-card">
        <div class="card-header">
            <h3>‚ö° Estado del Sistema</h3>
        </div>
        
        <div class="detail-grid">
            <div class="detail-item">
                <div class="detail-label">Veh√≠culos Activos</div>
                <div class="detail-value">{{ porcentaje_vehiculos_activos }}%</div>
            </div>
            
            <div class="detail-item">
                <div class="detail-label">Aeronaves Activas</div>
                <div class="detail-value">{{ porcentaje_aeronaves_activas }}%</div>
            </div>
            
            <div class="detail-item">
                <div class="detail-label">Personal Activo</div>
                <div class="detail-value">{{ porcentaje_personal_activo }}%</div>
            </div>
            
            <div class="detail-item">
                <div class="detail-label">Seguros Vigentes</div>
                <div class="detail-value">{{ porcentaje_seguros_vigentes }}%</div>
            </div>
        </div>

        <!-- Acciones R√°pidas para Admin -->
        {% if user.is_superuser or user.perfilusuario.tipo_usuario == 'ADMIN' %}
        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
            <h4 style="margin-bottom: 1rem;">üöÄ Acciones R√°pidas</h4>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <a href="{% url 'despacho_crear' %}" class="btn">‚ûï Nuevo Despacho</a>
                <a href="{% url 'generar_reporte_pdf' %}" class="btn btn-secondary">üìä Generar Reporte</a>
                <a href="{% url 'gestion_usuarios' %}" class="btn btn-success">üë• Gestionar Usuarios</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Seguros Recientes -->
<div class="content-card">
    <div class="card-header">
        <h3>üõ°Ô∏è Seguros Recientes</h3>
        <a href="{% url 'seguros' %}" class="btn">Ver Todos</a>
    </div>
    
    {% if seguros_recientes %}
        <div class="detail-grid">
            {% for seguro in seguros_recientes %}
            <div class="detail-item">
                <div class="detail-label">P√≥liza {{ seguro.numero_poliza }}</div>
                <div class="detail-value">{{ seguro.aseguradora }}</div>
                <div style="margin-top: 0.5rem;">
                    <span class="badge {% if seguro.estado == 'VIGENTE' %}active{% else %}warning{% endif %}">
                        {{ seguro.estado }}
                    </span>
                    <span style="font-size: 0.85rem; color: var(--text-secondary); margin-left: 0.5rem;">
                        Vence: {{ seguro.vigencia_hasta|date:"d/m/Y" }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
            No hay seguros registrados
        </div>
    {% endif %}
</div>

<style>
.table th {
    background: rgba(51, 65, 85, 0.3);
    font-weight: 600;
    color: var(--text-secondary);
}

.table tr:hover {
    background: rgba(51, 65, 85, 0.2);
}
</style>
{% endblock %}